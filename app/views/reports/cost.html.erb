<%= render partial: 'report_navigation' %>

<div class="tab-content" id="inst_show_content">

  <div class="tab-pane" id="cost">
    <h3>Cost Analysis</h3>
    <% if @institution.is_a?(SubscriptionInstitution) || @cost_report[:subscribers].nil? %>
        <p>You currently have <%= number_to_human_size(@cost_report[:total_file_size]) %> stored, billed at <%= cost_analysis_subscriber(@cost_report[:total_file_size]) %>.</p>
    <% else %>
        <p>You currently have <%= number_to_human_size(@cost_report[:subscribers]['total_bytes']) %> stored, billed at <%= cost_analysis_member(@cost_report[:subscribers]['total_bytes']) %>.</p>
        <p>If your cost is $0.00, then you have not yet used the full 10TB afforded by your membership.</p>
        <h3>Subscriber Cost Breakdown</h3>
        <% if @cost_report[:subscribers].nil? || @cost_report[:subscribers] == {} || @cost_report[:subscribers].count == 1 %>
            <p>You currently have no subscribers</p>
        <% else %>
            <dl class="dl-horizontal">
              <% @cost_report[:subscribers].each do |key, value| %>
                  <% unless key == 'total_bytes' %>
                      <dt><%= key %></dt>
                      <dd><%= cost_analysis_subscriber(@cost_report[:subscribers][key]) %></dd>
                  <% end %>
              <% end %>
            </dl>
        <% end %>
    <% end %>
    <h3>Previous Database Cost Analysis Snapshots</h3>
    <table class="table">
      <thead>
      <tr>
        <th>Audit Date</th>
        <th>Data in APTrust</th>
        <th>Storage Cost</th>
      </tr>
      </thead>
      <tbody>
      <% unless @institution.snapshots.nil? %>
          <% @institution.snapshots.each do |snapshot| %>
              <tr>
                <td><%= snapshot.audit_date %></td>
                <td><%= number_to_human_size(snapshot.apt_bytes) %></td>
                <td>$<%= snapshot.cost %></td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
  </div>

</div>